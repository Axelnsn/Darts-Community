# Story 6.5: Email Visibility Control

## Status: Draft

## Story

**As a** player,
**I want** to control whether my email is visible,
**so that** I protect my contact information.

## Acceptance Criteria

1. Email visibility toggle in privacy settings
2. Options: Public (visible on profile), Private (hidden)
3. Private emails encrypted at rest in database
4. Contact section hidden if email is private and no other contact method
5. Default: Private

## Tasks / Subtasks

- [ ] Task 1: Add Email Visibility Toggle (AC: 1, 2)
  - [ ] Add email_visible toggle in privacy settings
  - [ ] Display current setting

- [ ] Task 2: Update Privacy Logic (AC: 2)
  - [ ] Check email_visible before displaying email
  - [ ] Apply in public profile view

- [ ] Task 3: Email Encryption (AC: 3)
  - [ ] Implement encryption for user email if private
  - [ ] Use Laravel's encryption helpers
  - [ ] Decrypt when needed for display to owner

- [ ] Task 4: Contact Section Logic (AC: 4)
  - [ ] Hide contact section if email private
  - [ ] Show only if email public

- [ ] Task 5: Default Value (AC: 5)
  - [ ] Set email_visible default to false
  - [ ] Apply to existing users

## Dev Notes

### Relevant Architecture References

**Player Field:**
```php
- email_visible: boolean default false
```

**Email Encryption (optional for MVP):**
```php
use Illuminate\Support\Facades\Crypt;

// Encrypt
$encrypted = Crypt::encryptString($email);

// Decrypt
$decrypted = Crypt::decryptString($encrypted);
```

**Note:** For MVP, email_visible boolean may be sufficient without actual encryption. Full encryption can be added later.

**Display Logic:**
```blade
@if($player->email_visible && $player->user->email)
    <p>Email: {{ $player->user->email }}</p>
@endif
```

### Testing

**Test Location:** `tests/Feature/Privacy/EmailVisibilityTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
