# Story 1.2: Email/Password Authentication

## Status: Draft

## Dependencies

- **Requires:** [Story 1.1 - Project Setup & Landing Page](1.1.project-setup-landing-page.md) completed

## Story

**As a** new user,
**I want** to register with my email and password,
**so that** I can create an account without social media.

## Acceptance Criteria

1. Laravel Breeze installed and configured for session-based auth
2. Registration form collects: email, password, password confirmation
3. Email validation (format, uniqueness)
4. Password requirements enforced (min 8 characters)
5. Successful registration redirects to dashboard/profile placeholder
6. Login form with email/password fields
7. "Forgot password" flow functional with email reset link
8. All forms display validation errors in French
9. Rate limiting applied to auth endpoints (5 attempts/minute)

## Tasks / Subtasks

- [ ] Task 1: Install and Configure Laravel Breeze (AC: 1)
  - [ ] Run `composer require laravel/breeze --dev`
  - [ ] Run `php artisan breeze:install blade`
  - [ ] Run migrations `php artisan migrate`
  - [ ] Verify Breeze views are created in `resources/views/auth/`

- [ ] Task 2: Customize Registration Form (AC: 2, 3, 4)
  - [ ] Modify `resources/views/auth/register.blade.php`
  - [ ] Apply Tailwind CDN styling (remove Vite references)
  - [ ] Add French labels and placeholders
  - [ ] Ensure validation rules in `RegisteredUserController`

- [ ] Task 3: Customize Login Form (AC: 6)
  - [ ] Modify `resources/views/auth/login.blade.php`
  - [ ] Apply Tailwind CDN styling
  - [ ] Add French labels and placeholders
  - [ ] Add "Remember me" checkbox

- [ ] Task 4: Configure Password Reset Flow (AC: 7)
  - [ ] Verify `forgot-password.blade.php` exists
  - [ ] Verify `reset-password.blade.php` exists
  - [ ] Configure SMTP settings in `.env` (Mailtrap for dev)
  - [ ] Test email sending functionality

- [ ] Task 5: French Localization (AC: 8)
  - [ ] Create `lang/fr/` directory
  - [ ] Create `lang/fr/validation.php` with French messages
  - [ ] Create `lang/fr/auth.php` with French messages
  - [ ] Set `config/app.php` locale to 'fr'

- [ ] Task 6: Implement Rate Limiting (AC: 9)
  - [ ] Configure RateLimiter in `AppServiceProvider`
  - [ ] Apply 5 attempts/minute to login route
  - [ ] Apply 5 attempts/minute to register route
  - [ ] Display rate limit error message in French

- [ ] Task 7: Create Player on Registration (AC: 5)
  - [ ] Modify `RegisteredUserController` to create Player record
  - [ ] Generate unique `public_slug` for player
  - [ ] Redirect to profile edit page after registration

## Dev Notes

### Relevant Architecture References

> See: [docs/architecture.md](../architecture.md) Section 6.1 (Authentication Component)
> See: [docs/architecture.md](../architecture.md) Section 10.4 (Authentication Flow)
> See: [docs/front-end-spec.md](../front-end-spec.md) Section 3.2.2 (Auth Screens)

**Authentication Stack:**
- Laravel Breeze for email/password authentication scaffolding
- Session-based authentication (not API tokens for MVP)
- Session driver: database

**User Model Fields:**
```php
- id: bigint unsigned
- email: string unique
- password: string nullable
- oauth_provider: string nullable
- oauth_id: string nullable
- is_admin: boolean default false
- email_verified_at: timestamp nullable
```

**File Locations:**
- Controllers: `app/Http/Controllers/Auth/`
- Views: `resources/views/auth/`
- Routes: `routes/auth.php`

**Environment Variables (.env) - SMTP for Development:**
```env
MAIL_MAILER=smtp
MAIL_HOST=sandbox.smtp.mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=your_mailtrap_username
MAIL_PASSWORD=your_mailtrap_password
MAIL_FROM_ADDRESS="noreply@darts-community.fr"
MAIL_FROM_NAME="${APP_NAME}"
```

**Important: Remove Vite Dependencies**
Breeze installs Vite by default. You must:
1. Remove `@vite` directives from Blade templates
2. Add Tailwind Play CDN script instead

### Testing

**Test Location:** `tests/Feature/Auth/`

```php
public function test_new_users_can_register(): void
{
    $response = $this->post('/register', [
        'email' => 'test@example.com',
        'password' => 'password123',
        'password_confirmation' => 'password123',
    ]);

    $this->assertAuthenticated();
    $this->assertDatabaseHas('players', [
        'user_id' => User::first()->id,
    ]);
}
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.1 | Added dependencies, architecture refs, SMTP config | Bob (SM) |
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
