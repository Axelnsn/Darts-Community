# Story 7.6: Club & Federation Management

## Status: Draft

## Story

**As an** administrator,
**I want** to manage clubs and federations,
**so that** the platform data stays accurate.

## Acceptance Criteria

1. CRUD interface for federations
2. CRUD interface for clubs
3. Bulk import clubs from CSV (for initial data population)
4. View players affiliated with each club
5. Merge duplicate clubs (transfer all players to target club)
6. Deactivate clubs (hide from selection, preserve history)

## Tasks / Subtasks

- [ ] Task 1: Federation CRUD (AC: 1)
  - [ ] Create AdminFederationController
  - [ ] Create federation views (index, create, edit)
  - [ ] Add routes

- [ ] Task 2: Club CRUD (AC: 2)
  - [ ] Create AdminClubController
  - [ ] Create club views (index, create, edit)
  - [ ] Add routes

- [ ] Task 3: CSV Import (AC: 3)
  - [ ] Create import form
  - [ ] Parse CSV file
  - [ ] Create clubs from CSV data
  - [ ] Handle duplicates

- [ ] Task 4: View Club Players (AC: 4)
  - [ ] Show player list on club detail page
  - [ ] Count players per club

- [ ] Task 5: Merge Clubs (AC: 5)
  - [ ] Add merge action
  - [ ] Transfer all players to target club
  - [ ] Update club history
  - [ ] Delete source club

- [ ] Task 6: Deactivate Club (AC: 6)
  - [ ] Add deactivate action
  - [ ] Set is_active = false
  - [ ] Hide from player selection
  - [ ] Preserve in history

## Dev Notes

### Relevant Architecture References

**CSV Import Format:**
```csv
name,city,federation_code
"Darts Club Paris",Paris,FFD
"Les FlÃ¨ches Lyonnaises",Lyon,FFD
```

**Merge Logic:**
```php
public function merge(Club $source, Club $target): void
{
    // Update all players
    Player::where('club_id', $source->id)
        ->update(['club_id' => $target->id]);

    // Update club history
    ClubHistory::where('club_id', $source->id)
        ->update(['club_id' => $target->id]);

    // Delete source
    $source->delete();
}
```

**Routes:**
```php
Route::resource('/admin/federations', FederationController::class);
Route::resource('/admin/clubs', ClubController::class);
Route::post('/admin/clubs/import', [ClubController::class, 'import']);
Route::post('/admin/clubs/{id}/merge', [ClubController::class, 'merge']);
```

### Testing

**Test Location:** `tests/Feature/Admin/ClubManagementTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
