# Story 4.1: Admin Role & Access Control

## Status: Draft

## Story

**As a** system administrator,
**I want** admin-only access to catalog management,
**so that** only authorized users can modify the catalog.

## Acceptance Criteria

1. Admin role added to User model (is_admin boolean)
2. Admin middleware protecting catalog routes
3. First user or seeded user marked as admin
4. Admin navigation visible only to admin users
5. Non-admin users redirected if accessing admin routes

## Tasks / Subtasks

- [ ] Task 1: Add is_admin to User Model (AC: 1)
  - [ ] Ensure is_admin column exists in users table
  - [ ] Add isAdmin() helper method to User model

- [ ] Task 2: Create AdminMiddleware (AC: 2, 5)
  - [ ] Create `app/Http/Middleware/AdminMiddleware.php`
  - [ ] Check auth and is_admin flag
  - [ ] Abort 403 if not admin
  - [ ] Register in kernel

- [ ] Task 3: Create Admin Routes (AC: 2)
  - [ ] Create `routes/admin.php`
  - [ ] Apply auth and admin middleware
  - [ ] Include in RouteServiceProvider

- [ ] Task 4: Create AdminUserSeeder (AC: 3)
  - [ ] Create seeder for admin user
  - [ ] Use darts.nerd1@gmail.com as admin email
  - [ ] Mark as is_admin = true

- [ ] Task 5: Admin Navigation (AC: 4)
  - [ ] Create admin layout `resources/views/layouts/admin.blade.php`
  - [ ] Add admin nav link in main layout (visible to admins only)
  - [ ] Create basic admin dashboard placeholder

## Dev Notes

### Relevant Architecture References

**AdminMiddleware:**
```php
class AdminMiddleware
{
    public function handle(Request $request, Closure $next)
    {
        if (!auth()->check() || !auth()->user()->is_admin) {
            abort(403, 'Accès non autorisé.');
        }
        return $next($request);
    }
}
```

**Admin Routes Structure:**
```php
// routes/admin.php
Route::middleware(['auth', 'admin'])->prefix('admin')->name('admin.')->group(function () {
    Route::get('/', [DashboardController::class, 'index'])->name('dashboard');
    // ... other admin routes
});
```

### Testing

**Test Location:** `tests/Feature/Admin/AccessControlTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
