# Story 5.3: Dart Assembly Builder

## Status: Draft

## Story

**As a** player,
**I want** to assemble components into complete darts,
**so that** I can define my dart configurations.

## Acceptance Criteria

1. Dart model: tip_id, barrel_id, shaft_id, flight_id, player_id, name
2. "Create Dart" interface showing 4 component slots
3. Select components from player's inventory for each slot
4. Visual representation of assembled dart
5. Name the dart configuration (e.g., "Match Darts", "Practice Set")
6. Save dart assembly to database
7. Edit/delete existing dart assemblies

## Tasks / Subtasks

- [ ] Task 1: Create DartAssembly Model & Migration (AC: 1)
  - [ ] Create DartAssembly model
  - [ ] Create migration with all component FK fields
  - [ ] Add relationships to PlayerComponent

- [ ] Task 2: Create AssemblyController (AC: 2, 6, 7)
  - [ ] Create `app/Http/Controllers/AssemblyController.php`
  - [ ] Implement index, create, store, edit, update, destroy

- [ ] Task 3: Create Assembly Builder View (AC: 2, 3, 4, 5)
  - [ ] Create `resources/views/pages/equipment/assembly.blade.php`
  - [ ] Display 4 component slots (tip, barrel, shaft, flight)
  - [ ] Dropdown selectors from player's inventory
  - [ ] Visual dart representation
  - [ ] Name input field

- [ ] Task 4: Assembly Validation (AC: 6)
  - [ ] Validate all 4 components selected
  - [ ] Validate components belong to player
  - [ ] Validate correct component types

- [ ] Task 5: Edit/Delete Assembly (AC: 7)
  - [ ] Create edit view
  - [ ] Handle update logic
  - [ ] Handle delete with confirmation

## Dev Notes

### Relevant Architecture References

**DartAssembly Model:**
```php
- id: bigint unsigned
- player_id: bigint unsigned
- name: string
- tip_component_id: bigint unsigned (FK to player_components)
- barrel_component_id: bigint unsigned
- shaft_component_id: bigint unsigned
- flight_component_id: bigint unsigned
- is_current_setup: boolean default false
- display_order: tinyint nullable
```

**Validation:**
```php
// Ensure component belongs to player and is correct type
$tipComponent = PlayerComponent::where('id', $request->tip_component_id)
    ->where('player_id', auth()->user()->player->id)
    ->firstOrFail();
```

### Testing

**Test Location:** `tests/Feature/Equipment/AssemblyTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
