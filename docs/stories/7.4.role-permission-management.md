# Story 7.4: Role & Permission Management

## Status: Draft

## Story

**As an** administrator,
**I want** to manage admin roles,
**so that** I can delegate platform management.

## Acceptance Criteria

1. View list of all admin users
2. Promote regular user to admin role
3. Revoke admin role (cannot revoke own role)
4. Super-admin concept: first admin cannot be demoted
5. Admin action history visible per admin user
6. Confirmation modal for role changes

## Tasks / Subtasks

- [ ] Task 1: Admin Users List (AC: 1)
  - [ ] Create admin list view
  - [ ] Show all users with is_admin = true

- [ ] Task 2: Promote User (AC: 2)
  - [ ] Add "Promote to Admin" action
  - [ ] Update is_admin to true
  - [ ] Log action

- [ ] Task 3: Revoke Admin (AC: 3, 4)
  - [ ] Add "Revoke Admin" action
  - [ ] Prevent self-demotion
  - [ ] Prevent demoting super-admin (first admin)
  - [ ] Log action

- [ ] Task 4: Admin Action History (AC: 5)
  - [ ] Show actions performed by each admin
  - [ ] Filter AdminActionLog by admin_user_id

- [ ] Task 5: Confirmation Modals (AC: 6)
  - [ ] Add confirmation for promote
  - [ ] Add confirmation for revoke

## Dev Notes

### Relevant Architecture References

**Super Admin Logic:**
```php
// First registered admin (lowest ID with is_admin = true)
$superAdmin = User::where('is_admin', true)->orderBy('id')->first();

// Cannot demote super admin
if ($user->id === $superAdmin->id) {
    return back()->with('error', 'Impossible de r√©voquer le super-administrateur.');
}
```

**Routes:**
```php
Route::post('/admin/users/{id}/promote', [UserController::class, 'promote']);
Route::post('/admin/users/{id}/demote', [UserController::class, 'demote']);
```

### Testing

**Test Location:** `tests/Feature/Admin/RoleManagementTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
