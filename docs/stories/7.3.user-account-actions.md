# Story 7.3: User Account Actions

## Status: Draft

## Story

**As an** administrator,
**I want** to perform actions on user accounts,
**so that** I can manage the platform effectively.

## Acceptance Criteria

1. View any user's full profile (bypass privacy settings)
2. Edit user's basic info (email, name) with audit note
3. Suspend/reactivate user account with reason
4. Force password reset (sends email to user)
5. Delete user account (with confirmation, respects GDPR grace period)
6. Impersonate user (login as user for debugging) - optional, with audit log
7. All admin actions logged with timestamp and admin user

## Tasks / Subtasks

- [ ] Task 1: View Full Profile (AC: 1)
  - [ ] Show all profile sections regardless of privacy
  - [ ] Add link from user detail page

- [ ] Task 2: Edit User Info (AC: 2)
  - [ ] Add edit form for email, name
  - [ ] Require audit note/reason
  - [ ] Log changes

- [ ] Task 3: Suspend/Reactivate (AC: 3)
  - [ ] Add suspend action with reason input
  - [ ] Add reactivate action
  - [ ] Add is_suspended field to User model
  - [ ] Block suspended users from login

- [ ] Task 4: Force Password Reset (AC: 4)
  - [ ] Add "Force Reset" button
  - [ ] Send password reset email
  - [ ] Log action

- [ ] Task 5: Delete User (AC: 5)
  - [ ] Add delete action with confirmation
  - [ ] Apply soft delete
  - [ ] Respect 30-day GDPR period

- [ ] Task 6: Admin Action Logging (AC: 7)
  - [ ] Create AdminActionLog model if not exists
  - [ ] Log all admin actions
  - [ ] Display action history on user detail

## Dev Notes

### Relevant Architecture References

**AdminActionLog Model:**
```php
- id: bigint unsigned
- admin_user_id: bigint unsigned
- action_type: string (suspend_user, delete_user, edit_user, etc.)
- target_type: string (User, Player, etc.)
- target_id: bigint unsigned
- details: json nullable
- created_at: timestamp
```

**Logging Action:**
```php
AdminActionLog::create([
    'admin_user_id' => auth()->id(),
    'action_type' => 'suspend_user',
    'target_type' => 'User',
    'target_id' => $user->id,
    'details' => ['reason' => $reason],
]);
```

**Routes:**
```php
Route::put('/admin/users/{id}', [UserController::class, 'update']);
Route::post('/admin/users/{id}/suspend', [UserController::class, 'suspend']);
Route::post('/admin/users/{id}/activate', [UserController::class, 'activate']);
Route::post('/admin/users/{id}/reset-password', [UserController::class, 'forceResetPassword']);
Route::delete('/admin/users/{id}', [UserController::class, 'destroy']);
```

### Testing

**Test Location:** `tests/Feature/Admin/UserActionsTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
