# Story 2.4: Walk-on Song Configuration

## Status: Draft

## Story

**As a** player,
**I want** to set my walk-on song,
**so that** I can express my personality like professional players.

## Acceptance Criteria

1. Walk-on song section on profile edit page
2. Option 1: YouTube URL input with embed preview
3. Option 2: Spotify URL input with embed preview
4. Option 3: MP3 file upload (max 2 minutes, max 10MB)
5. URL validation for YouTube/Spotify formats
6. MP3 duration validation (reject files > 2 minutes)
7. Audio player displayed on profile view
8. User can switch between embed and upload options
9. User can remove walk-on song

## Tasks / Subtasks

- [ ] Task 1: Create WalkonSongController (AC: 2, 3, 4, 8, 9)
  - [ ] Create controller with store/destroy methods
  - [ ] Handle YouTube URL storage
  - [ ] Handle Spotify URL storage
  - [ ] Handle MP3 upload

- [ ] Task 2: URL Validation (AC: 5)
  - [ ] Create WalkonSongRequest
  - [ ] Validate YouTube URL format
  - [ ] Validate Spotify URL format

- [ ] Task 3: MP3 Upload & Validation (AC: 4, 6)
  - [ ] Validate MP3 file type
  - [ ] Validate file size (max 10MB)
  - [ ] Validate duration (max 2 minutes)
  - [ ] Store in `storage/app/public/walkon/`

- [ ] Task 4: Update Profile Edit View (AC: 1, 8, 9)
  - [ ] Add walk-on song section
  - [ ] Tab/toggle between YouTube/Spotify/MP3
  - [ ] Show preview for embeds
  - [ ] Add remove button

- [ ] Task 5: Create Walkon Player Component (AC: 7)
  - [ ] Create `resources/views/components/profile/walkon-player.blade.php`
  - [ ] Render YouTube embed iframe
  - [ ] Render Spotify embed iframe
  - [ ] Render HTML5 audio player for MP3

## Dev Notes

### Relevant Architecture References

**Player Model Fields:**
```php
- walkon_song_type: enum('youtube', 'spotify', 'mp3') nullable
- walkon_song_url: text nullable (URL or file path)
```

**YouTube Embed URL Pattern:**
```
Input: https://www.youtube.com/watch?v=VIDEO_ID
Embed: https://www.youtube.com/embed/VIDEO_ID
```

**Spotify Embed URL Pattern:**
```
Input: https://open.spotify.com/track/TRACK_ID
Embed: https://open.spotify.com/embed/track/TRACK_ID
```

**MP3 Duration Validation:**
Use `getID3` library or `ffprobe` to check duration.

### Testing

**Test Location:** `tests/Feature/Profile/WalkonSongTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
