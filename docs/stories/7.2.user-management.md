# Story 7.2: User Management

## Status: Draft

## Story

**As an** administrator,
**I want** to view and manage all user accounts,
**so that** I can support users and handle issues.

## Acceptance Criteria

1. User list view with search and filters (by email, name, registration date, status)
2. Sortable columns (date registered, last login, profile completion)
3. User detail view showing:
   - Account info (email, registration date, OAuth provider)
   - Player profile summary
   - Account status (active, suspended, pending deletion)
4. Pagination for large user lists
5. Export user list to CSV (basic implementation)

## Tasks / Subtasks

- [ ] Task 1: Create AdminUserController (AC: 1, 3)
  - [ ] Create `app/Http/Controllers/Admin/UserController.php`
  - [ ] Implement index with filters
  - [ ] Implement show for user details

- [ ] Task 2: User List View (AC: 1, 2, 4)
  - [ ] Create `resources/views/admin/users/index.blade.php`
  - [ ] Add search input
  - [ ] Add filter dropdowns
  - [ ] Add sortable column headers
  - [ ] Add pagination

- [ ] Task 3: User Detail View (AC: 3)
  - [ ] Create `resources/views/admin/users/show.blade.php`
  - [ ] Display account info
  - [ ] Display player profile summary
  - [ ] Display account status

- [ ] Task 4: CSV Export (AC: 5)
  - [ ] Add export method
  - [ ] Generate CSV with user data
  - [ ] Download file

## Dev Notes

### Relevant Architecture References

**User List Query:**
```php
$users = User::query()
    ->with('player')
    ->when($search, fn($q) => $q->where('email', 'like', "%{$search}%"))
    ->when($status, fn($q) => $q->where('is_suspended', $status === 'suspended'))
    ->orderBy($sortBy, $sortDir)
    ->paginate(25);
```

**Routes:**
```php
Route::get('/admin/users', [UserController::class, 'index'])->name('admin.users.index');
Route::get('/admin/users/{id}', [UserController::class, 'show'])->name('admin.users.show');
Route::get('/admin/users/export', [UserController::class, 'export'])->name('admin.users.export');
```

### Testing

**Test Location:** `tests/Feature/Admin/UserManagementTest.php`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 1.0 | Initial story creation from PRD | Sarah (PO) |
